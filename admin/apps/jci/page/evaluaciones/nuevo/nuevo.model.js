"use strict";var cargarURL=function(){fetch("../config.json").then((e=>e.json())).then((e=>{window.host=e.URL,KTNuevaEvaluacion.init(),cargarValoresDesdeURL()})).catch((e=>{console.error("Error al cargar el archivo JSON:",e)}))},KTNuevaEvaluacion=function(){var e,o,a,t,n,i;const r=(i=new URLSearchParams(window.location.search)).get("periodo"),s=i.get("servicio"),c=i.get("colaborador");$("[name='periodo']").on("change.select2",(function(){!function(){const e={usuario:document.querySelector("#session_usuario_id").value,id_periodo:null==r?$("[name='periodo']").val():r,usuario_rol:document.querySelector("#session_rol_id").value},o=new URLSearchParams(e).toString();$("[name='servicio']").empty(),fetch(`${window.host}/API/jci/encuestas/combo-servicios?${o}`,{method:"GET"}).then((e=>e.json())).then((e=>{if(1==e.estado){e.data.forEach((e=>{$("[name='servicio']").append(new Option(e.nom_area,e.id_area))})),$("[name='servicio']").prop("disabled",!1),$("[name='servicio']").val(""),null==r?$("[name='servicio']").val(""):$("[name='servicio']").val(s),l()}else $("[name='servicio']").prop("disabled",!0);d()}))}()})),$("[name='servicio']").on("change.select2",(function(){l()})),$("[name='colaborador']").on("change.select2",(function(){d()}));function d(){var e=null!=$("[name='servicio']").val()&&null!=$("[name='colaborador']").val()&&null!=$("[name='periodo']").val();return o.disabled=!e,e}function l(){const e={usuario:document.querySelector("#session_usuario_id").value,usuario_rol:document.querySelector("#session_rol_id").value,id_periodo:null==r?$("[name='periodo']").val():r,id_servicio:null==s?$("[name='servicio']").val():s},o=new URLSearchParams(e).toString();$("[name='colaborador']").empty(),fetch(`${window.host}/API/jci/encuestas/combo-colaborador?${o}`,{method:"GET"}).then((e=>e.json())).then((e=>{if(1==e.estado){e.data.forEach((e=>{const o=new Option(e.nom_colaborador,e.id_colaborador);o.setAttribute("data-encuesta",e.id_encuesta),$("[name='colaborador']").append(o)})),$("[name='colaborador']").prop("disabled",!1),$("[name='colaborador']").val(""),null==s?$("[name='colaborador']").val(""):$("[name='colaborador']").val(c)}else $("[name='colaborador']").prop("disabled",!0);d()}))}return $("[name='periodo']").on("select2:clear",(function(){$("[name='servicio']").empty(),null==r?$("[name='periodo']").val(""):$("[name='periodo']").val(r),$("[name='servicio']").trigger("change.select2"),$("[name='servicio']").trigger("select2:clear")})),$("[name='servicio']").on("select2:clear",(function(){$("[name='colaborador']").empty(),null==s?$("[name='servicio']").val(""):$("[name='servicio']").val(s),$("[name='colaborador']").trigger("select2:clear")})),$("[name='colaborador']").on("select2:clear",(function(){null==c?$("[name='colaborador']").val(""):($("[name='colaborador']").val(c),$("[name='colaborador']").prop("disabled",!1))})),$("[data-control='select2']").on("change",(function(){var e=$(this).attr("name");t.revalidateField(e)})),{init:function(){n=document.getElementById("formEvaluacion"),e=document.getElementById("btn_guardar_evaluacion"),o=document.getElementById("btn_continuar_evaluacion"),a=document.getElementById("btn_limpiar_evaluacion"),o.disabled=!0,document.querySelectorAll('[data-kt-nueva-evaluacion="opciones"]').forEach((e=>{$(e).hasClass("select2-hidden-accessible")||$(e).select2({minimumResultsForSearch:-1})})),t=FormValidation.formValidation(n,{fields:{periodo:{validators:{notEmpty:{message:"Seleccione un periodo"}}},servicio:{validators:{notEmpty:{message:"Seleccione un servicio"}}},colaborador:{validators:{notEmpty:{message:"Seleccione un colaborador"}}},codigo:{validators:{notEmpty:{message:"El código de colaborador es obligatorio"}}},supervisor:{validators:{notEmpty:{message:"El nombre del supervisor es obligatorio"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),e.addEventListener("click",(o=>{$("[name='colaborador'] option:selected"),$("[name='colaborador'] option:selected").data("encuesta"),o.preventDefault(),t&&t.validate().then((function(o){if("Valid"==o){e.setAttribute("data-kt-indicator","on"),e.disabled=!0;const o=new FormData(document.getElementById("formEvaluacion"));o.append("id_supervisor",document.querySelector("#session_usuario_id").value),o.append("id_encuesta",$("[name='colaborador'] option:selected").data("encuesta")),o.append("periodo",$("[name='periodo']").val()),o.append("servicio",$("[name='servicio']").val()),setTimeout((function(){fetch(`${window.host}/API/jci/encuestas/agregar-respuesta`,{method:"POST",body:o}).then((e=>e.json())).then((o=>{1==o.estado?Swal.fire({icon:"question",title:"¿Está seguro(a) que desea guardar los cambios?",showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",confirmButtonColor:"#00b2a9"}).then((e=>{e.isConfirmed&&Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los cambios han sido guardados exitosamente",showConfirmButton:!1,timer:3e3})})):Swal.fire({toast:!0,position:"top-end",icon:"warning",title:"Debe marcar por lo menos una opción",showConfirmButton:!1,timer:1500}),e.setAttribute("data-kt-indicator","off"),e.disabled=!1}))}),500)}else Swal.fire({html:"Lo siento, se han detectado campos <strong>obligatorios</strong> pendientes de llenado",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, entendido",customClass:{confirmButton:"btn btn-primary"}})}))})),a.addEventListener("click",(function(e){$("[name='periodo']").trigger("select2:clear"),$("[name='periodo']").trigger("change.select2"),document.getElementById("div-cuestionario").classList.add("d-none")})),o.addEventListener("click",(e=>{if(e.preventDefault(),d()){o.setAttribute("data-kt-indicator","on");const e=new FormData;e.append("id_supervisor",document.querySelector("#session_usuario_id").value),e.append("id_encuesta",$("[name='colaborador'] option:selected").data("encuesta")),e.append("periodo",$("[name='periodo']").val()),e.append("servicio",$("[name='servicio']").val()),setTimeout((function(){fetch(`${window.host}/API/jci/encuestas/cargar-respuestas`,{method:"POST",body:e}).then((e=>e.json())).then((e=>{if(1==e.estado){o.setAttribute("data-kt-indicator","off"),o.disabled=!0,a.disabled=!0;for(const o in e.data){const a=e.data[o],t=document.querySelector(`input[name="radio_preg_${o}"][value="${a}"]`);if(t){t.checked=!0;const e=t.closest(".custom-label");e&&e.classList.add("active")}}Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Verificación exitosa, puede continuar",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}else 2==e.estado?(o.setAttribute("data-kt-indicator","off"),o.disabled=!0,a.disabled=!0,Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Verificación exitosa, puede iniciar",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})):Swal.fire({toast:!0,position:"top-end",icon:"error",title:"Ha sucedido un error, vuelva a intentarlo",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});document.getElementById("div-cuestionario").classList.remove("d-none"),document.getElementById("div-guardar").classList.remove("d-none"),$("[name='periodo']").prop("disabled",!0),$("[name='servicio']").prop("disabled",!0),$("[name='colaborador']").prop("disabled",!0)}))}),500)}else Swal.fire({toast:!0,position:"top-end",icon:"warning",title:"Hay campos obligatorios pendientes de completar",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}))}}}();function cargarValoresDesdeURL(){const e=new URLSearchParams(window.location.search).get("periodo");e&&($("[name='periodo']").val(e).trigger("change"),$("[name='periodo']").trigger("change.select2"))}KTUtil.onDOMContentLoaded((function(){cargarURL()}));